<div class="page-container">
  <nz-card [nzLoading]="loading" class="cita-card">
    <h2 class="card-title">Editar Cita</h2>

    <form nz-form>
      <!-- Fecha -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="fecha">Fecha</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <nz-date-picker
            id="fecha"
            [(ngModel)]="fecha"
            name="fecha"
            nzFormat="dd/MM/yyyy"
            class="full-width"
          ></nz-date-picker>
        </nz-form-control>
      </nz-form-item>

      <!-- Hora -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="hora">Hora</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <nz-time-picker
            id="hora"
            [(ngModel)]="hora"
            name="hora"
            nzFormat="HH:mm"
            class="full-width"
          ></nz-time-picker>
        </nz-form-control>
      </nz-form-item>

      <!-- Cliente -->
      <nz-form-item>
        <nz-form-label [nzSpan]="24" nzFor="clienteId">Cliente</nz-form-label>
        <nz-form-control [nzSpan]="24">
          <nz-select
            id="clienteId"
            [(ngModel)]="clienteId"
            name="clienteId"
            nzPlaceHolder="Seleccione un cliente"
            class="full-width"
          >
            <nz-option
              *ngFor="let cliente of clientes"
              [nzValue]="cliente.id"
              [nzLabel]="cliente.nombres"
            ></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>

      <!-- Selección de atención -->
      <nz-form-item>
        <nz-form-control [nzSpan]="24" class="atencion-row">
          <nz-select
            [(ngModel)]="atencionId"
            name="atencionId"
            nzPlaceHolder="Selecciona una atención"
            class="atencion-select"
          >
            <nz-option
              *ngFor="let a of atenciones"
              [nzValue]="a.id"
              [nzLabel]="a.nombre"
            ></nz-option>
          </nz-select>
          <button
            nz-button
            nzType="dashed"
            type="button"
            (click)="agregarDetalle()"
          >
            +
          </button>
        </nz-form-control>
      </nz-form-item>

      <!-- Tabla de detalles -->
      <div class="table-wrapper" *ngIf="detallesExistentes.length + detallesNuevo.length > 0">
        <nz-table [nzBordered]="true">
          <thead>
            <tr>
              <th>Atención</th>
              <th>Precio</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let d of detallesExistentes; let i = index">
              <td>{{ d.nombre || d.atencion.nombre }}</td>
              <td>{{ d.precio || d.atencion.precio }}</td>
              <td>
                <button
                  nz-button
                  nzType="default"
                  nzSize="small"
                  (click)="eliminarDetalleTabla(d)"
                >
                  Eliminar
                </button>
              </td>
            </tr>
          </tbody>
        </nz-table>
      </div>

      <!-- Botón Guardar -->
      <div class="btn-guardar-container">
        <button nz-button nzType="primary" (click)="save()">Actualizar</button>
      </div>
    </form>
  </nz-card>
</div>
